var $$=$$||{};!function(t){t.TimeCapsule=function(){function e(){$$.util=new t.Util,$$.util.init(),$$.timeLine.init(),$$.timeData.init(),$$.timeWork.init()}e()}}(jQuery),$(function(){new $.TimeCapsule}),function(t){t.Form=function(){function e(){n(),t(":checked").trigger("click")}function n(){t(":checkbox").click(function(){var e=t(this).next("label");t(this).is(":checked")?e.addClass("on"):e.removeClass("on"),t(this).is(":checked")?t(this).prop("checked",!0):t(this).prop("checked",!1)}),t(":radio").click(function(){var e=t(this).next("label"),n=t(this).attr("name"),i=t("input[name="+n+"]").next();i.removeClass("on"),t(this).is(":checked")&&(t("input[name="+n+"]").prop("checked",!1),t(this).prop("checked",!0),e.addClass("on"))})}return{init:e}}}(jQuery),function(t){t.Util=function(){function e(){Array.prototype.removeElement=function(t){return this.splice(t,1),this},Array.indexOf||(Array.prototype.indexOf=function(t,e){for(var n=e||0;n<this.length;n++)if(this[n]==t)return n})}var n,i,a=function(){return"f"+(Math.random()*(1<<30)).toString(16).replace(".","")},o=function(t){for(var e=t.split("\n"),n="",i=0;i<e.length;i++)n+=i==e.length-1?e[i]:e[i]+"<br />";return n},r=function(t){for(var e=t.split("<br />"),n="",i=0;i<e.length;i++)n+=i==e.length-1?e[i]:e[i]+"\n";return n},d=function(t){var e=t.offset();return e.top},s=function(e,n,i,a){var o=n||t(e).offset().top,r=i||800;a?a():null;t("body").animate({scrollTop:o},r,function(){})},l=function(t,e,n){return t.split(e).join(n)},c=function(e,a,o){function r(t){var e=t,a=e.currentTarget;if(e.cancelBubble?e.cancelBubble=!0:e.stopPropagation&&e.stopPropagation(),"mouseover"==c||"mousemove"==c)var o=e.pageX,r=e.pageY,d=s.offset(),u=o-d.left,m=r-d.top;if(l&&(s.attr("title",""),i.html(f)),"mouseover"==c||"mousemove"==c)var p=("A"==a.nodeName?i.outerWidth():n.outerWidth(),"A"==a.nodeName?i.outerHeight():n.outerHeight());"A"==a.nodeName?(void 0!=n&&n.hide(),i.show()):n.show(),"mouseover"!=c&&"mousemove"!=c||("A"==a.nodeName?i.css({left:u-20,top:m-p-10}):n.css({left:u-20,top:m-p-10}))}function d(e){var a=e,o=a.currentTarget;"A"==o.nodeName?i.hide():n.hide(),l&&(i.html(""),t(this).attr("title",f))}var s=e,l=a,c=o,f="";l?(f=s.attr("title"),i=s.find(".bubble")):n=s.find(".tooltip"),s.bind({mouseenter:function(t){var e=t;r(e)},mousemove:function(t){var e=t;r(e)},mouseleave:function(t){var e=t;d(e)}}),"mouseover"==c&&s.unbind("mousemove")};return{init:e,rKey:a,returnBr:o,returnLine:r,elemTop:d,scrollTo:s,replaceAll:l,tooltip:c}}}(jQuery),$$.timeData=function(t){var e,n,i,a,o,r,d,s,l,c,f,u,m,p,h,v=null,g=null,D=null,b=new Date,$=[];return _init=function(){e=b.getFullYear(),n=b.getMonth()+1,i=b.getDate(),null==g&&(g=h(e,n-1))},s=function(t){var a=t;return v>g?(a.setDate(a.getDate()+1),n=a.getMonth()+1,i=a.getDate(),v=D):(e=a.getFullYear(),n=a.getMonth()+1,i=a.getDate(),null==v&&(v=D=i),v>i&&(i=a.getDate()+1)),(n<10?"0":"")+n+"/"+(i<10?"0":"")+i+"/"+e},l=function(e,n,i){if("new"==t(".container").data("mode")&&(b=new Date),1==e){var l=n/2;o=f(l),a=s(b)}else{var c=(n+i)/2;d=f(c),r=s(b)}return{startDate:function(){return a},endDate:function(){return r},startTime:function(){return o},endTime:function(){return d}}},m=function(t){var e,n,i=t;n=TimeModel.extend(i),$.push(n),$.sort(function(t,e){return t.startPoint<e.startPoint?-1:t.startPoint>e.startPoint?1:0});for(var a=0;a<$.length;a++)$[a].id===i.id&&(e=$.indexOf($[a]));return setTimeout(function(){$$.timeWork.showMsg("#msgBx"),$$.timeWork.countTotal()},200),e},p=function(t){return t&&($=t),!0},c=function(t,e){return t>e?1:t<e?-1:0},f=function(t){var e,n,i=$$.timeLine.getCurrentHour(),a=Math.floor(t/60)+i,o=24;return a>=o?(D=b.getDate(),a%=o,v=D+1):v=D,e=Math.floor(t%60),n=(a<10?"0":"")+a+":"+(e<10?"0":"")+e},u=function(t){for(var e,n,i=t,a=0;a<$.length;a++)$[a].id===i&&(e=$.indexOf($[a]));$[e].done&&(n=$$.timeWork.getDoneCnt(),n--,$$.timeWork.countDone(n)),$.removeElement(e),$$.timeWork.countTotal(),$$.timeWork.processChk(200,function(){this.delTimeList(i)})},h=function(t,e){return 32-new Date(t,e,32).getDate()},{init:_init,setObjDate:function(t){D=null,b=t},getStoredData:function(){return $},getTime:l,removeData:u,saveData:m,loadData:p}}(jQuery),$$.timeLine=function(t){var e,n,i,a,o,r,d=null,s=10,l=null;return e=function(t){var e=t,a=new Date;d=e?e:a.getHours(),i("#time-line",d),l=$$.timelineNav,n()},n=function(){var e=t("#left"),n=t("#right");e.on("click",l.goPrev),n.on("click",l.goNext);var i=t("#time-list").find("li > a");i.on("click",function(e){var n=t(this);l.goMove(e,n)})},i=function(e,n){var i=t(e).css("width","3000px");a(n),o(i)},a=function(e){var n=24,i=e,a=0;t("#time-list").empty();for(var o=i;o<n+1&&!(a>=n+1);o++){var r=document.createElement("li");o%=n,a++,r.innerHTML="<a href='#'>"+(o<10?"0":"")+o+":00</a>",document.getElementById("time-list").appendChild(r)}t("#time-list").children().eq(0).addClass("first")},o=function(e){var n=r(),i=e;i.empty();for(var a=0;a<n;a++)t('<div class="unit bg1" />').appendTo(i)},r=function(){var e=t("#time-sheet").outerWidth();return e/s},{init:e,getPxToHour:function(){var t=s/2;return 60*s/t},getCurrentHour:function(){return d}}}(jQuery),$$.timelineNav=function(t){var e=0,n=$$.timeLine.getPxToHour(),i=t("#time-sheet"),a=i.outerWidth()-t(".time-inner").outerWidth();return t(window).on("resize",function(e){var n=parseInt(i.css("left"));a=i.outerWidth()-t(".time-inner").outerWidth(),Math.abs(n)>a&&i.css("left","-"+a+"px")}),{goPrev:function(t){i.is(":animated")||(0==e?e:e--,i.animate({left:"-"+n*e+"px"})),t.preventDefault()},goNext:function(t){var o,r;i.is(":animated")||(e>=17?e:e++,r=n*e,o=r>a?a:r,i.animate({left:"-"+o+"px"})),t.preventDefault()},goMove:function(o,r){var d,s,l=r.parent(),c=t("#time-list").children().index(l);e=c>18?18:c,s=n*e,d=s>a?a:s,i.animate({left:"-"+d+"px"},"slow"),o.preventDefault()}}}(jQuery);var objectCreate=function(t){function e(){}return t?(e.prototype=t,new e):{}};Object.create=Object.create||objectCreate;var TimeModel={id:0,startDate:"0000-00-00",startTime:"00:00",startPoint:0,endDate:"0000-00-00",endTime:"00:00",endPoint:0,title:"",description:"",done:!1,drawBar:function(t,e,n,i){var a,o,r,d,s=e,l=new $.Util;s.css("width",i),s.data("active",!1),a=$('<div class="btn btn-default btn-xs mytool" role="group" aria-label="MY Tool"><a href="#" class="edit" data-toggle="modal" data-target="#todoModal" data-mode="EDIT" title="EDIT"><span class="glyphicon glyphicon-edit" aria-hidden="true"></span><p class="bubble"></p></a><a href="#" class="del" title="DELETE"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span><p class="bubble"></p></a></div>'),s.find(".inner").append(a),o=s.find(".del"),r=s.find(".edit"),d=String()+'<div class="tooltip">',d+='<span class="title"></span>',d+='<span class="time"></span>',d+='<span class="desc"></span>',d+="</div>",s.find(".wrapper").append(d),l.tooltip($(".wrapper",s),!1,"mousemove"),l.tooltip(o,!0,"mousemove"),l.tooltip(r,!0,"mousemove")},extend:function(t){var e,n=Object.create(this);for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}};$$.timeWork=function(t){var e,n,i,a,o,r,d,s,l,c,f,u,m,p,h,v,g,D,b,$,T,w,k,y,C,x=null,M=null,P=0,_=0,A=!1,L=!1,E=0,S={},W="",j=null,H=null,I=!1,O=null,X=t("#time-line"),N=t("#todoModal");return n=function(n){t(".container").data("mode","new"),o(),e=setInterval(o,1e3),i()},i=function(){var e=a();t(".capsule").one(e,function(e){t(this).find("span").addClass("shadow showIn")}),X.on("click",function(e){var n,i=e;i.stopPropagation(),P++,P>=2?(n=h(i,O),n&&N.modal({keyboard:!0}),P=0,A=!1):(p(i,t(this)),A=!0)}),X.on("mousemove",function(t){var e=t;v(e,O)}),t(document).on("keydown",function(e){var n=e;A&&27===n.keyCode&&(t("#bar_"+_).remove(),P=0,A=!1)}),t(document).on("click",".btn-load",function(e){t(this).hide(),t(".api-select").css("display","inline-block")}),t(document).on("click",".dropdown-menu a",function(e){var n=t(this).data("url");f(n)}),t(document).on("click",".btn-send",function(t){var e,n=t,i={},a=$$.timeData.getStoredData();n.preventDefault(),i.todo=a,e=JSON.stringify(i)}),t(document).on("click",".mytool .del",function(){var e=t(this).parents(".bar").data("set").id;return t("#alert").data("id",e),t("#alert").show(),t("#alert").find(".alert").addClass("alert-delete"),t("#alert").find(".msg")[0].innerHTML="<strong>Delete!</strong><br />Do you want to delete it?",!1}),t(document).on("click",".alert-delete .btn",function(){var e=t(this).parents("#alert").data("id");t(this).hasClass("btn-ok")&&(t("#bar_"+e).remove(),$$.timeData.removeData(e)),t(this).parent(".alert").removeClass("alert-delete"),t("#alert").hide()}),t(document).on("click",".bar input:checkbox",function(){var e=t(this).parents(".bar").data("set").id;t("#alert").data("id",e),t("#alert").show(),t("#alert").find(".alert").addClass("alert-status"),t("#alert").find(".msg")[0].innerHTML=t(this).is(":checked")?"<strong>Wait!</strong><br />Do you want to change it in progress?":"<strong>Wait!</strong><br />Do you want to change it to Done?"}),t(document).on("click",".alert-status .btn",function(){var e=t(this).parents("#alert").data("id"),n=t("#bar_"+e).find(".switch input:checkbox").is(":checked");t(this).hasClass("btn-ok")?m(e):t("#bar_"+e).find(".switch input:checkbox").prop("checked",!n),t(this).parent(".alert").removeClass("alert-status"),t("#alert").hide()}),t(document).on("click",".todo-list .more",function(e){return e.preventDefault(),t(this).hasClass("glyphicon-chevron-up")?(t(this).parents(".flag-wrapper").find(".desc p").removeClass("opened"),t(this).removeClass("glyphicon-chevron-up").addClass("glyphicon-chevron-down"),!1):(t(this).parents(".flag-wrapper").find(".desc p").addClass("opened"),void t(this).removeClass("glyphicon-chevron-down").addClass("glyphicon-chevron-up"))}),t(document).on("click",".modal .modal-backdrop",function(){N.find("#cancel").trigger("click")}),N.find("#save").on("click",function(t){var e,n;L=!0,e=s(),e&&(l.call(O,e),n=$$.timeData.saveData(e),c(200,function(){b(".todo-area",n)}),N.modal("hide"),_="",W="",L=!1)}),N.find("#edit").on("click",function(t){var e,n=_,i=$$.timeData.getStoredData();if("EDIT"==W&&(e=s())){l.call(O,e);for(var a=0;a<i.length;a++)i[a].id===n&&(i[a].title=e.title,i[a].description=e.description);c(200,function(){_updateTimeList(".todo-area",e)}),N.modal("hide"),W="",_=""}}),N.find("#cancel, .close").on("click",function(e){"SAVE"==W&&t("#bar_"+_).remove(),N.modal("hide"),W="",_=""}),N.on("keydown",function(t){var e=t,n=e.target.getAttribute("id");N.find("#todo-title").val().length&&N.find("#todo-title").removeClass("warn"),"todoModal"!=n&&"todo-title"!=n&&"todo-desc"!=n||27===e.keyCode&&N.find("#cancel").trigger("click")}),N.on("show.bs.modal",function(e){var n,i=t(e.relatedTarget),a=i.parents(".bar"),o=t("#todoModal").find(".txt-time");if(W=i.data("mode"),"EDIT"==W){n=a.data("set");var r,d=n.description;d&&(r=$$.util.returnLine(d),N.find("#todo-desc").empty().val(r)),N.find("#todo-title").empty().val(n.title),N.find("#startDate").empty().append(n.startDate),N.find("#endDate").empty().append(n.endDate),N.find("#startTime").empty().append(n.startTime),N.find("#endTime").empty().append(n.endTime),N.find("#save").hide(),N.find("#edit").show(),N.find(".modal-title .mode").text("Edit"),_=n.id}else o.find("#startDate").empty().append(j.startDate()),o.find("#endDate").empty().append(j.endDate()),o.find("#startTime").empty().append(j.startTime()),o.find("#endTime").empty().append(j.endTime()),N.find("#save").show(),N.find("#edit").hide(),N.find(".modal-title .mode").text("Register"),W="SAVE";N.find("#todo-title").focusin()}),N.on("hidden.bs.modal",function(){N.find("#todo-title").val(""),N.find("#todo-desc").val("")})},a=function(){var t,e=document.createElement("fakeelement"),n={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"};for(t in n)if(void 0!==e.style[t])return n[t]},o=function(){var e=t("#clock"),n=new Date,i=n.getFullYear(),a=n.getMonth()+1,o=n.getDate();a=a>9?a:"0"+a,o=o>9?o:"0"+o,e.find(".date")[0].innerHTML=a+"/"+o+"/"+i,e.find(".time")[0].innerHTML=d()},r=function(n){I&&(clearInterval(e),t("#clock").find(".date").addClass("only").text(n),t("#clock").find(".time").hide())},d=function(){var t=new Date,e=t.getHours(),n=e<12||24==e?"AM":"PM";e=e%12||12;var i=t.getMinutes();i=i>9?i:"0"+i;var a=t.getSeconds();a=a>9?a:"0"+a;var o=t.getMilliseconds();o=o>99?o:o>9?"0"+o:"00"+o;var r=e+":"+i+":"+a+" <sup>"+n+"</sup>";return r},f=function(e){var n=e,i=!1;t.getJSON(n,function(t){i=$$.timeData.loadData(t.todo)}).done(function(e){i&&(E=0,c(500,function(){t(".time-area").length&&t(".time-area").remove(),u(),b(".todo-area")}))})},c=function(e,n){var i=this;t('<div id="loading" />').appendTo("body"),H=setTimeout(function(){n&&"function"==typeof n&&n.call(i),t("#loading").remove(),H=null},e)},u=function(){var e,n=$$.timeData.getStoredData(),i=new Date(n[0].startDate),a=n[0].startTime,o={};W="LOAD",I=!0,e=parseInt(a.split(":")[0]),r(n[0].startDate),t(".container").data("mode","loaded"),$$.timeData.setObjDate(i),$$.timeLine.init(e),t(".bar").length&&t(".bar").remove(),t.each(n,function(e,n){var i=n.endPoint-n.startPoint;O=t('<div class="bar" id="bar_'+n.id+'" data-set=""><div class="wrapper progress"><div class="inner"><div class="switch demo1"><input type="checkbox"><label><i></i></label></div></div></div></div>'),o={id:n.id,startDate:n.startDate,startTime:n.startTime,startPoint:n.startPoint,endDate:n.endDate,endTime:n.endTime,endPoint:n.endPoint,title:n.title,description:n.description,done:n.done},n.done&&E++,t("#time-sheet").css("left",0).append(O),O.css("left",n.startPoint),TimeModel.drawBar(X,O,n.startPoint,i),l.call(O,o),g(),D(E)})},s=function(){var e=_,n={},i="SAVE"==W,a=N.find("#todo-title").val(),o=N.find("#todo-desc").val(),r=null;return O=t("#bar_"+e),a?(o.length>0&&(r=$$.util.returnBr(o)),n={id:e,startDate:i?j.startDate():O.data("set").startDate,startTime:i?j.startTime():O.data("set").startTime,startPoint:i?x:O.data("set").startPoint,endDate:i?j.endDate():O.data("set").endDate,endTime:i?j.endTime():O.data("set").endTime,endPoint:i?x+M:O.data("set").endPoint,title:a,description:r,done:!i&&O.data("set").done}):(N.find("#todo-title").addClass("warn").attr("placeholder","Please enter a title!"),N.find("#todo-title").focus(),!1)},l=function(e){var n,i=e;"SAVE"==W?(this.find(".switch input:checkbox").prop("checked",!0),this.appendTo(t("#time-sheet"))):"LOAD"==W&&(this.find(".switch input:checkbox").prop("checked",!i.done),this.appendTo(t("#time-sheet"))),this.data("set",i),n=this.find(".tooltip").addClass("in"),n.find(".title").text(this.data("set").title),n.find(".time").text(this.data("set").startTime+"-"+this.data("set").endTime),this.data("set").description?n.find(".desc").show().html(this.data("set").description):n.find(".desc").hide()},m=function(e){var n=$$.timeData.getStoredData(),i=e,a=t("#bar_"+i).data("set").done;t("#bar_"+i).data("set").done=!a,t(".todo-list").find(".time_"+i).toggleClass("done");for(var o=0;o<n.length;o++)n[o].id===i&&(n[o].done=0==a,n[o].done?E++:E--);D(E)},p=function(e,n){var i,a=e,o=($$.timeData.getStoredData(),n);_=$$.util.rKey(),O=t('<div class="bar" id="bar_'+_+'" data-set=""><div class="wrapper progress"><div class="inner"><div class="switch demo1"><input type="checkbox"><label><i></i></label></div></div></div></div>'),o.append(O),i=O.offset(),x=a.pageX-i.left,O.css("left",x).css("width","2px"),$$.timeData.getTime(P,x)},h=function(e,n){var i,a=e,o=$$.timeLine.getPxToHour(),r=n;return i=r.offset(),M=a.pageX-i.left,M&&M<o/2?(t("#bar_"+_).remove(),P=0,A=!1,!1):M&&A?(j=$$.timeData.getTime(P,x,M),TimeModel.drawBar(X,r,x,M),!0):void 0},v=function(t,e){var n=t,i=e;if(A){var a=i.offset(),o=n.pageX-a.left;i.css("width",o+2)}},g=function(){var e=$$.timeData.getStoredData().length,n=t(".panel-info").find(".total");return n.find(".badge").text(e),e},D=function(e){var n=e,i=t(".panel-info").find(".done");E=n,i.find(".badge").text(E)},b=function(e,n){var i=t(e),a=i.data("template"),o=$$.timeData.getStoredData(),r=!1,d=n||0;i.find(".nolist").hide(),r=T(i,d,o,a),r&&(t(".content").css("height","auto"),t(".content").css("height",t(".content").outerHeight()))},_updateTimeList=function(e,n){var i,a=n,o=t(e).find(".time_"+a.id);o.find(".title").text(a.title),a.description?(o.find(".desc").show(),o.find(".desc .txts").html(a.description)):o.find(".desc").hide(),o.find(".desc>p").removeClass("opened"),o.find(".more").removeClass("glyphicon-chevron-up").addClass("glyphicon-chevron-down"),setTimeout(function(){o.find(".desc .txts").height()>o.find(".desc").height()?0==o.find(".flag-wrapper .more").length&&(i=String()+'<a href="#" class="glyphicon glyphicon-chevron-down more">더보기</a>',o.find(".flag-wrapper").append(i)):o.find(".flag-wrapper .more").remove()},300)},$=function(e){var n,i=e;n=t("li.time_"+i).parent(".todo-list"),n.find("li.time_"+i).remove(),_len=n.find("li").length,0==_len&&(n.parents(".time-area").remove(),n.remove()),g()||(t(".todo-area").find(".nolist").show(),S.date="",S.offsetX="",S.offsetX2=""),setTimeout(function(){C(n),t(".content").css("height","auto"),t(".content").css("height",t(".content").outerHeight())},1e3)},T=function(e,n,i,a){var o,r,d,s=e,l=0,c=i,f=a;return t.ajax({type:"GET",async:!1,url:f,success:function(e){s.find(".todo-list").empty(),t.each(c,function(n,i){var a=t(e).find(".todo-list > li"),c=$$.util.replaceAll(i.startDate,"/","-");if(S.date!=i.startDate){if(0==s.find(".date_"+c).size()){var f;S.date&&(S.offsetX2=i.startPoint),S.offsetX2<S.offsetX?s.prepend(e):s.append(e),f=S.offsetX2<S.offsetX?0:-1,s.find(".time-area").eq(f).addClass("date_"+c),t(".date_"+c).find(".time-tit").text(i.startDate)}else s.find(".date_"+c).find(".todo-list").append(a);S.date=i.startDate,S.offsetX=i.startPoint,l=0}else s.find(".date_"+c).find(".todo-list").append(a);o=s.find(".date_"+c).find(".todo-list"),d=o.find("li").eq(l),d.addClass("time_"+i.id),d.find(".title").text(i.title),d.find(".start-time").text(i.startTime),d.find(".end-time").text(i.endTime),i.done&&d.addClass("done"),i.description?d.find(".desc .txts").html(i.description):d.find(".desc").hide(),d.find(".desc .txts").height()>d.find(".desc").height()&&(r=String()+'<a href="#" class="glyphicon glyphicon-chevron-down more">더보기</a>',d.find(".flag-wrapper").append(r)),l%2==0?d.find(".direction-r").removeClass("direction-r").addClass("direction-l"):d.find(".direction-l").removeClass("direction-l").addClass("direction-r"),l++})}}),!0},w=function(e){t(e).addClass(function(n){var i;t(e).is(":hidden")&&(t(e).css("display","block"),i="show-in");parseInt(t(this).css("top"));return t(e).css("transform","translateY(50px)"),i}),setTimeout(function(){k(e)},1500)},k=function(e){parseInt(t(e).css("top"));t(e).css("transform","translateY(-50px)"),t(e).removeClass("show-in"),setTimeout(function(){t(e).css("display","none")},1e3)},C=function(e){var n=t(e).find("li");n.each(function(){var n=t(e).find("li").index(this),i=t(this).find(".direction-l"),a=t(this).find(".direction-r");if(n%2==1)a.hasClass("in")&&a.addClass("slideInRight").removeClass("in"),i.removeClass("direction-l").addClass("direction-r");else{var o=a.removeClass("direction-r").addClass("direction-l");o.hasClass("in")&&o.addClass("slideInLeft").removeClass("in")}})},y=function(e,n){var i,a=e,o=n;return a.find("li").each(function(e){var n;e==o&&(n=o%2==1?"slideInRight":"slideInLeft",t(this).find("div[class*='direction']").addClass(n),i=this)}),i},{init:n,showMsg:w,processChk:c,delTimeList:$,countTotal:g,countDone:D,getDoneCnt:function(){return E}}}(jQuery);